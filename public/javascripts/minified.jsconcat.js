app=angular.module("movieSeat",["ngMaterial","ngFitText","ui-notification"]),app.config(["NotificationProvider",function(e){e.setOptions({delay:4500,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"})}]),angular.module("movieSeat").factory("movieFactory",["$http","$q",function(e,o){var t={};return t.selectMovie=function(t){var i=o.defer();return e({method:"JSONP",url:"https://api.themoviedb.org/3/movie/"+t.id+"?api_key=a8f7039633f2065942cd8a28d7cadad4&append_to_response=credits,images,videos&callback=JSON_CALLBACK"}).success(function(e){i.resolve(e)}).catch(function(){i.reject()}),i.promise},t.addMovie=function(t){var i=o.defer();return e({method:"POST",url:"/movies",data:t}).success(function(e){i.resolve(e)}).catch(function(){i.reject()}),i.promise},t.removeMovie=function(t){var i=o.defer();return e({method:"DELETE",url:"/movies",data:t,headers:{"Content-Type":"application/json;charset=utf-8"}}).success(function(e){i.resolve(e)}).catch(function(){i.reject()}),i.promise},t}]),angular.module("movieSeat").controller("moviesearchCtrl",["$rootScope","getmovieFactory","movieFactory","moviesearchFactory","$scope","$q","$timeout","Notification",function(e,o,t,i,n,a,r,s){n.addMovie=function(o){t.selectMovie(o).then(function(i){t.addMovie(i),s.success(o.title+" has been added to your watchlist"),n.movies=[],n.overlay=!1,n.searchquery="",e.$broadcast("onAddMovieEvent",o)})},n.$on("onRemoveMovieEvent",function(o,i){t.removeMovie(i).then(function(){s.success(i.title+" has been removed from your watchlist"),e.$broadcast("onRemoveMovieEventUpdate",i)})}),n.closeSearch=function(){n.movies=[],n.overlay=!1,n.searchquery=""},n.overlay=!1,n.showResult=!1,n.createList=function(e){n.overlay=!0,n.showResult=!0,n.searchquery.length>0?(n.showProgress=!0,n.toggleSsomething=!1,i.searchMovies(e).then(function(e){function o(){function e(e){return a(function(o){var t=new Image;t.src=e,t.onload=function(){o(t)}})}var o=[];return n.moviesPreload.forEach(function(t){o.push(e(t.pre_load_poster_path))}),a.all(o).then(function(){n.movies=n.moviesPreload,n.showProgress=!1})}n.moviesResponse=e,n.noResult=n.moviesResponse.length>0?!1:!0,n.moviesPreload=[],n.moviesResponse.forEach(function(e){null!==e.poster_path&&""!==e.release_date&&(""==e.overview&&(e.overview="No summary available"),n.moviesPreload.push({id:e.id,poster_path:e.poster_path,pre_load_poster_path:"http://image.tmdb.org/t/p/w92"+e.poster_path,title:e.title,release_date:e.release_date}))}),o()})):(n.movies=[],n.noResult=!1,n.model={},n.toggleSsomething=!1,n.overlay=!1,n.searchquery="")},n.model={},n.toggleDisplay=function(e){e==n.model.displayedIndex?(n.model.displayedIndex=-1,n.toggleSsomething=!1):(n.model.displayedIndex=e,n.toggleSsomething=!0),r(function(){for(var e=document.getElementsByClassName("container_additional_information"),o=document.getElementsByClassName("additional_info "),t=0;o.length>t;t++)e[t].style.height=Number(o[t].clientHeight)+"px"},25)}}]),angular.module("movieSeat").factory("moviesearchFactory",["$http","$q",function(e,o){var t={};return t.searchMovies=function(t){var i=o.defer();return e({method:"JSONP",url:"https://api.themoviedb.org/3/search/movie?api_key=a8f7039633f2065942cd8a28d7cadad4&query="+encodeURIComponent(t)+"&callback=JSON_CALLBACK"}).success(function(e){i.resolve(e.results)}).catch(function(){i.reject()}),i.promise},t}]),angular.module("movieSeat").controller("getmovieController",["$rootScope","getmovieFactory","$scope","$filter","$q","$timeout",function(e,o,t,i,n,a){t.moviesX=[],t.removeMovie=function(o){t.model.rowIndex=null,t.transition="fadeOut",e.$broadcast("onRemoveMovieEvent",o),a(function(){t.overview=!1,t.movieDetail={},t.movieDetail.backdrop_path="/yqyZLEfSiSeqmn5oRahbOUTUHd9.jpg",t.transition=""},300)},getmovieFactoryFN=function(){o.getMovies().then(function(e){function o(){function e(e){return n(function(o){var t=new Image;t.src=e,t.onload=function(){o(t)}})}var o=[];return t.moviesPreload.forEach(function(t){o.push(e("http://image.tmdb.org/t/p/w500"+t.poster_path))}),n.all(o).then(function(){t.movies=t.moviesPreload;var e,o,n,a=i("orderBy"),r=a(t.movies,"release_date",!0),s=8;for(t.movieGroups=[],e=0,o=r.length;o>e;e+=s)n=r.slice(e,e+s),t.movieGroups.push(n);t.loadingWatchlist=!0})}t.moviesX=e,t.moviesPreload=e,t.loadingWatchlist=!1,o()})},getmovieFactoryFN(),t.$on("onAddMovieEvent",function(e,o){t.moviesX.push(o),t.movieGroups=[];var n,a,r,s=i("orderBy"),c=s(t.moviesX,"release_date",!0),l=8;for(n=0,a=c.length;a>n;n+=l)r=c.slice(n,n+l),t.movieGroups.push(r)}),t.$on("onRemoveMovieEventUpdate",function(e,o){console.log("onRemoveMovieEventUpdate");var n=t.moviesX.indexOf(o);t.moviesX.splice(n,1),t.movieGroups=[];var a,r,s,c=i("orderBy"),l=c(t.moviesX,"release_date",!0),v=8;for(a=0,r=l.length;r>a;a+=v)s=l.slice(a,a+v),t.movieGroups.push(s)}),t.model={},t.toggleRow=function(e,o){if(t.movieDetail==o)return t.model.rowIndex=null,t.transition="fadeOut",a(function(){t.overview=!1,t.movieDetail={},t.movieDetail.backdrop_path=o.backdrop_path,t.transition=""},300),void 0;e!==t.model.rowIndex&&(t.model.rowIndex=e);var i=document.getElementById("movie_details_container");angular.element(i).hasClass("fadeIn")?(t.overview=!0,t.transition="fadeOut",a(function(){t.movieDetail=o,t.transition="fadeIn"},300)):(t.transition="fadeIn",t.overview=!0,t.movieDetail=o)},t.close=function(){t.model.rowIndex=null,t.transition="fadeOut",a(function(){t.overview=!1,t.movieDetail={},t.movieDetail.backdrop_path="/yqyZLEfSiSeqmn5oRahbOUTUHd9.jpg",t.transition=""},300)}}]),angular.module("movieSeat").factory("getmovieFactory",["$http","$q",function(e,o){var t={};return t.getMovies=function(){var t=o.defer();return e({method:"GET",url:"movies"}).success(function(e){t.resolve(e)}).catch(function(){t.reject()}),t.promise},t}]);